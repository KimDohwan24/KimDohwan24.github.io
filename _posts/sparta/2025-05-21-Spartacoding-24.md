---
layout: post
title: Cookie, Session, Token
subtitle: 인증 / 인가
categories: TIL
tags: [TIL]
---

## Cookie
- 사용자의 웹 브라우저에 저장되는 정보로 사용자의 상태 혹은 세션을 유지하거나 사용자 경험을 개선하기 위해 사용된다.
- 서버가 `Set-Cookie` 해더를 통해 브라우저에게 쿠키를 저장하게 하고, 이후 브라우저는 요청마다 쿠키를 `Cookie`헤더에 실어 보낸다.
- 간단하게 `클라이언트에 저장되는 작은 데이터 파일`이다.

### Cookie 특징
- 클라이언트에 저장되며, 보통 키 - 값 쌍으로 구성된다.
- 로그인 정보, 세션 ID 등 상태 유지를 위한 정보를 담는데 사용된다.
- 기본적으로는 보안에 취약하므로 `HttpOnly`,`Secure`,`SameSite`등의 옵션을 설정하여 보안을 강화한다.

### Cookie를 사용하는 이유
1. Http는 Stateless, Connectionless 특성을 가지고 있다.
2. Client가 재요청시 Server는 이전 요청에 대한 정보를 기억하지 못한다.
3. 로그인과 같이 상태를 유지해야 하는 경우가 발생한다.
4. Request에 사용자 정보를 포함하면 해결이 된다 -> 로그인 후에는 사용자 정보와 관련된 값이 저장되어 있어야 한다.
5. 브라우저를 완전히 종료한 뒤 다시 열어도 사용자 정보가 유지되어야 한다.
6. 서버에 전송하지 않고 브라우저에 단순히 데이터를 저장하고 싶다면 Web Storage를 사용하면 되지만 보안에 취약하기 때문에 주민번호와 같은 민감정보를 저장하면 안된다!

### Cookie 동작 방법

1. 로그인 성공시 응답
- Set-Cookie
- 로그인시 전달된 ID,PassWord로 User 테이블 조회하여 일치 여부 확인
- 일치한다면 Set-Cookie를 활용해 Cookie에 사용할 값 저장 ( Cookie는 보안에 취약하다. )

2. 로그인 이후 요청
- 요청 헤더 `Cookie : 사용자 정보`
- 로그인 이후에는 모든 요청마다 Request Header에 항상 Cookie 값을 담아서 요청한다
- 네트워크 트래픽이 추가적으로 발생한다
- 최소한의 정보만 사용해야한다
- Cookie에 담겨있는 값으로 인증/인가를 진행한다.

### Cookie 보안

1. `Secure` 
- 기본적으로 Cookie는 http,https 구분하지 않고 전송한다.
- Secure를 적용하면 https인 경우에만 전송한다 ( s = Secure )

2. `HttpOnly`
- XSS(Cross-site Scription) 공격을 방지한다 : 악성 스크립트를 웹 페이지에 삽입하여 다른 사용자의 브라우저에서 실행되도록 하는 공격
- 자바스크립트에서 Cookie 접근을 못하도록 막는다.
- HTTP 요청시 사용한다

3. `SameSite` 
- 비교적 최신 기능이라 브라우저 지원여부를 확인 해야한다.
- CSRF(Cross-Site Request Forgery) 공격을 방지한다 : 사용자가 의도하지 않은 상태에서 특정 요청을 서버에 전송하게 하여 사용자 계정에서 원치 않는 행동을 하게 만든다.
- 요청 도메인과 쿠키에 설정된 도메인이 같은 경우만 쿠키 전송

### Cookie의 문제점
1. 쿠키 값은 임의로 변경할 수 있다
2. Cookie에 저장된 Data는 탈취되기 쉽다.
3. 용량이 제한되어 있다.
